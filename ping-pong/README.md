For latest python atari games on windows: https://github.com/AbhishekAshokDubey/atari-py<br/>

This is extention of karpathy's work, with required derivation/ proof provided below.<br/>

The neural network:
![diagram](https://raw.githubusercontent.com/AbhishekAshokDubey/RL/master/ping-pong/nn_diagram.PNG)

![notations](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20L_%7Bip%7D%5E%7Bi%7D%20%5Crightarrow%20input%5C%20to%5C%20layer%5C%20i%5C%5C%20L_%7Bop%7D%5E%7Bi%7D%20%5Crightarrow%20output%5C%20of%5C%20layer%5C%20i%5C%5C%20%5C%5C%20h%20%5Crightarrow%20L_%7Bop%7D%5E%7B2%7D%20%28%20output%5C%20of%5C%20hidden%5C%20layer%29%5C%5C%20%5C%5C%20y_%7Ba%7D%20%5Crightarrow%20is%5C%20the%5C%20true%5C%20label%5C%20of%5C%20y%20%5C%5C%20y_%7Bp%7D%20%5Crightarrow%20is%5C%20the%5C%20predicted%5C%20label%5C%20of%5C%20y%5C%5C%20y_%7Bp%7D%20%3D%20Sigm%28Relu%28x*W_%7B1%7D%29*W_%7B2%7D%29%5C%5C%20output%5C%20label%20%3D%20%5Cbegin%7BBmatrix%7D%201%20%26%20if%5C%20y_%7Bp%7D%20%3E%200.5%20%5C%5C%200%20%26%20otherwise%20%5Cend%7BBmatrix%7D)

As always we want to maximize the probability of output (up/down action) given input (game state)

![aim](https://latex.codecogs.com/gif.latex?%5C%5C%20max%5C%20P%28Y%7CX%29%5C%5C%20max%5C%20%5Csum_%7Bi%7D%5E%7BN%7D%20P%28y_%7Bi%7D%7Cx_%7Bi%7D%29%5C%5C%20P%28y%3Dy_%7Ba%7D%7Cx%29%20%3D%20y_%7Ba%7Dlog%28y_%7Bp%7D%29%20&plus;%20%281-y_%7Ba%7D%29log%281-y_%7Bp%7D%29%5C%5C)

For ease of discussion lets drop the ![sum_icon](https://latex.codecogs.com/png.latex?%5Cdpi%7B50%7D%20%5Csum) and, consider only one example

![wrtLO3](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20max%5C%20P%28y%7Cx%29%5C%5C%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20%28y_%7Ba%7Dlog%28y_%7Bp%7D%29%20&plus;%20%281-y_%7Ba%7D%29log%281-y_%7Bp%7D%29%29%5C%5C%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20%28y_%7Ba%7Dlog%28L_%7Bop%7D%5E%7B3%7D%29%20&plus;%20%281-y_%7Ba%7D%29log%281-L_%7Bop%7D%5E%7B3%7D%29%29%5C%5C%20%3Dy_%7Ba%7D%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20log%28L_%7Bop%7D%5E%7B3%7D%29&plus;%20%281-y_%7Ba%7D%29%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20log%281-L_%7Bop%7D%5E%7B3%7D%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20y_%7Ba%7D%5Cfrac%7B1%7D%20%7BL_%7Bop%7D%5E%7B3%7D%7D%20&plus;%20%281-y_%7Ba%7D%29%5Cfrac%7B-1%7D%20%7B%281-L_%7Bop%7D%5E%7B3%7D%29%7D%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.1%29%7D%5C%5C)

![](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20P%28y%7Cx%29*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20L_%7Bop%7D%5E%7B3%7D%5C%5C%20using%3A%5C%20%5Cfrac%7B%5Cmathrm%7Bd%7D%20%7D%7B%5Cmathrm%7Bd%7D%20x%7D%20sigm%28x%29%20%3D%20sigm%28x%29%20%281-sigm%28x%29%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B3%7D%7D%20P%28y%7Cx%29*%20L_%7Bop%7D%5E%7B3%7D%20%281-L_%7Bop%7D%5E%7B3%7D%29%5C%5C%20using%5C%20%28eq.1%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20%28y_%7Ba%7D%5Cfrac%7B1%7D%20%7BL_%7Bop%7D%5E%7B3%7D%7D%20&plus;%20%281-y_%7Ba%7D%29%5Cfrac%7B-1%7D%20%7B%281-L_%7Bop%7D%5E%7B3%7D%29%7D%29*%20L_%7Bop%7D%5E%7B3%7D%20%281-L_%7Bop%7D%5E%7B3%7D%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20y_%7Ba%7D%20%281-L_%7Bop%7D%5E%7B3%7D%29&plus;%20%28y_%7Ba%7D-1%29L_%7Bop%7D%5E%7B3%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20y_%7Ba%7D-y_%7Ba%7DL_%7Bop%7D%5E%7B3%7D%20&plus;%20y_%7Ba%7DL_%7Bop%7D%5E%7B3%7D-L_%7Bop%7D%5E%7B3%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20y_%7Ba%7D%20-%20L_%7Bop%7D%5E%7B3%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20%3D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.2%29%7D%5C%5C)

![](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%5C%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7DL_%7Bip%7D%5E%7B3%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%5C%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7D%20%28h*W_%7B2%7D%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%5C%20*%5C%20h%5C%5C%20using%5C%20%28eq.2%29%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%5C%20*%5C%20h%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.3%29%7D%5C%5C)

![](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B3%7D%7D%20P%28y%7Cx%29%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B2%7D%7D%20L_%7Bip%7D%5E%7B3%7D%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7DL_%7Bop%7D%5E%7B2%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bop%7D%5E%7B2%7D%7D%20%28L_%7Bop%7D%5E%7B2%7D*W_%7B2%7D%29%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7DL_%7Bop%7D%5E%7B2%7D%5C%5C%20%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%20*%20W_%7B2%7D%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7DL_%7Bop%7D%5E%7B2%7D%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.4%29%7D%5C%5C)

Note:
![](https://latex.codecogs.com/png.latex?%5Cdpi%7B100%7D%20%5C%5C%20L_%7Bop%7D%5E%7B2%7D%20%3D%20Relu%28L_%7Bip%7D%5E%7B2%7D%29%5C%5C)<br/>Since Relu is not differntiable (kink at 0), so we use sub-derivative

![eq5](https://latex.codecogs.com/gif.latex?%5C%5C%20Relu%28k%29%20%3D%20max%280%2Ck%29%5C%5C%20%5Cfrac%7B%5Cmathrm%7Bd%7D%20%7D%7B%5Cmathrm%7Bd%7D%20k%7D%20max%280%2Ck%29%20%3D%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7D%201%20%26%20%28k%3E0%5C%20or%5C%20equivalently%5C%20Relu%28k%29%3E0%29%5C%5C%200%20%26%20%28k%20%5Cleq%200%5C%20or%5C%20equivalently%5C%20Relu%28k%29%3D0%29%20%5Cend%7Bmatrix%7D%5Cright.%5C%5C%20%5C%5C%5C%5C%20substituting%5C%20above%5C%20in%5C%20%28eq.4%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%20*%20W_%7B2%7D%20%26%20L_%7Bop%7D%5E%7B2%7D%3E0%5C%5C%200%20%26%20L_%7Bop%7D%5E%7B2%7D%20%3D%200%20%5Cend%7Bmatrix%7D%5Cright.%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.5%29%7D%5C%5C)

![eq6](https://latex.codecogs.com/gif.latex?%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7DL_%7Bip%7D%5E%7B2%7D%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20*%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7D%20%28x*W_%7B1%7D%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20L_%7Bip%7D%5E%7B2%7D%7D%20P%28y%7Cx%29%20*%20x%5C%5C%20using%20%28eq.5%29%5C%5C%20%5Cfrac%7B%5Cpartial%20%5C%20%7D%7B%5Cpartial%20W_%7B1%7D%7D%20P%28y%7Cx%29%20%3D%20%5Cleft%5C%7B%5Cbegin%7Bmatrix%7D%20%28y_%7Ba%7D%20-%20y_%7Bp%7D%29%20*%20W_%7B2%7D%20*%20x%20%26%20L_%7Bop%7D%5E%7B2%7D%3E0%5C%5C%200%20%26%20L_%7Bop%7D%5E%7B2%7D%20%3D%200%20%5Cend%7Bmatrix%7D%5Cright.%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5Cleftarrow%20%5Cmathbf%7B%28eq.6%29%7D%5C%5C)

<br/>
<br/>

Useful tools:<br/>
https://www.codecogs.com/latex/eqneditor.php<br/>
https://go.gliffy.com/go/html5/launch<br/>
https://dillinger.io/
